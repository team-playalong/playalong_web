// ----------------------------------------------------------------------------
// Buzz, a Javascript HTML5 Audio library
// v 1.0.x beta
// Licensed under the MIT license.
// http://buzz.jaysalvat.com/
// ----------------------------------------------------------------------------
// Copyright (C) 2011 Jay Salvat
// http://jaysalvat.com/
// ----------------------------------------------------------------------------
var buzz = { defaults: { autoplay: !1, duration: 5E3, formats: [], loop: !1, placeholder: '--', preload: 'metadata', volume: 80 },
types: { mp3: 'audio/mpeg', ogg: 'audio/ogg', wav: 'audio/wav', aac: 'audio/aac', m4a: 'audio/x-m4a' },
sounds: [],
el: document.createElement('audio'),
sound: function(c, a) { function f(d) { for (var a = [], b = d.length - 1, e = 0; e <= b; e++)a.push({ start: d.start(b), end: d.end(b) }); return a; } function b(d, b) { var a = document.createElement('source'); a.src = b; buzz.types[b.split('.').pop()] && (a.type = buzz.types[b.split('.').pop()]);
d.appendChild(a); }a = a || {}; var g = 0,
h = [], 
k = {},
e = buzz.isSupported(); this.load = function() { if (!e) return this; this.sound.load(); return this; }; this.play = function() { if (!e) return this; this.sound.play(); return this; }; this.togglePlay = function() { if (!e) return this; this.sound.paused ? this.sound.play() : this.sound.pause(); return this; }; this.pause = function() { if (!e) return this; this.sound.pause(); return this; }; this.isPaused = function() { return !e ? null : this.sound.paused; }; this.stop = function() { if (!e) return this; this.setTime(0);
this.sound.pause(); return this; }; this.isEnded = function() { return !e ? null : this.sound.ended; }; this.loop = function() { if (!e) return this; this.sound.loop = 'loop'; this.bind('ended.buzzloop', function() { this.currentTime = 0; this.play(); }); return this; }; this.unloop = function() { if (!e) return this; this.sound.removeAttribute('loop'); this.unbind('ended.buzzloop'); return this; }; this.mute = function() { if (!e) return this; this.sound.muted = !0; return this; }; this.unmute = function() { if (!e) return this; this.sound.muted = !1; return this; }; this.toggleMute =
function() { if (!e) return this; this.sound.muted = !this.sound.muted; return this; }; this.isMuted = function() { return !e ? null : this.sound.muted; }; this.setVolume = function(d) { if (!e) return this; d < 0 && (d = 0); d > 100 && (d = 100); this.volume = d; this.sound.volume = d / 100; return this; }; this.getVolume = function() { return !e ? this : this.volume; }; this.increaseVolume = function(d) { return this.setVolume(this.volume + (d || 1)); }; this.decreaseVolume = function(d) { return this.setVolume(this.volume - (d || 1)); }; this.setTime = function(d) { if (!e) return this;
this.whenReady(function() { this.sound.currentTime = d; }); return this; }; this.getTime = function() { if (!e) return null; var d = Math.round(100 * this.sound.currentTime) / 100; return isNaN(d) ? buzz.defaults.placeholder : d; }; this.setPercent = function(d) { return !e ? this : this.setTime(buzz.fromPercent(d, this.sound.duration)); }; this.getPercent = function() { if (!e) return null; var d = Math.round(buzz.toPercent(this.sound.currentTime, this.sound.duration)); return isNaN(d) ? buzz.defaults.placeholder : d; }; this.setSpeed = function(d) { if (!e) return this;
this.sound.playbackRate = d; }; this.getSpeed = function() { return !e ? null : this.sound.playbackRate; }; this.getDuration = function() { if (!e) return null; var d = Math.round(100 * this.sound.duration) / 100; return isNaN(d) ? buzz.defaults.placeholder : d; }; this.getPlayed = function() { return !e ? null : f(this.sound.played); }; this.getBuffered = function() { return !e ? null : f(this.sound.buffered); }; this.getSeekable = function() { return !e ? null : f(this.sound.seekable); }; this.getErrorCode = function() { return e && this.sound.error ? this.sound.error.code : 0; };
this.getErrorMessage = function() { if (!e) return null; switch (this.getErrorCode()) { case 1:return 'MEDIA_ERR_ABORTED'; case 2:return 'MEDIA_ERR_NETWORK'; case 3:return 'MEDIA_ERR_DECODE'; case 4:return 'MEDIA_ERR_SRC_NOT_SUPPORTED'; default:return null; } }; this.getStateCode = function() { return !e ? null : this.sound.readyState; }; this.getStateMessage = function() { if (!e) return null; switch (this.getStateCode()) { case 0:return 'HAVE_NOTHING'; case 1:return 'HAVE_METADATA'; case 2:return 'HAVE_CURRENT_DATA'; case 3:return 'HAVE_FUTURE_DATA';
case 4:return 'HAVE_ENOUGH_DATA'; default:return null; } }; this.getNetworkStateCode = function() { return !e ? null : this.sound.networkState; }; this.getNetworkStateMessage = function() { if (!e) return null; switch (this.getNetworkStateCode()) { case 0:return 'NETWORK_EMPTY'; case 1:return 'NETWORK_IDLE'; case 2:return 'NETWORK_LOADING'; case 3:return 'NETWORK_NO_SOURCE'; default:return null; } }; this.set = function(d, b) { if (!e) return this; this.sound[d] = b; return this; }; this.get = function(d) { return !e ? null : d ? this.sound[d] : this.sound; }; this.bind =
function(d, b) { if (!e) return this; d = d.split(' '); for (var a = this, g = function(d) { b.call(a, d); }, c = 0; c < d.length; c++) { var f = d[c], 
j = f,
f = j.split('.')[0]; h.push({ idx: j, func: g }); this.sound.addEventListener(f, g, !0); } return this; }; this.unbind = function(d) { if (!e) return this; d = d.split(' '); for (var b = 0; b < d.length; b++) for (var a = d[b], g = a.split('.')[0], c = 0; c < h.length; c++) { var f = h[c].idx.split('.'); if (h[c].idx == a || f[1] && f[1] == a.replace('.', '')) this.sound.removeEventListener(g, h[c].func, !0), h.splice(c, 1); } return this; }; this.bindOnce =
function(d, b) { if (!e) return this; var a = this; k[g++] = !1; this.bind(d + '.' + g, function() { k[g] || (k[g] = !0, b.call(a)); a.unbind(d + '.' + g); }); }; this.trigger = function(b) { if (!e) return this; b = b.split(' '); for (var a = 0; a < b.length; a++) for (var c = b[a], g = 0; g < h.length; g++) { var f = h[g].idx.split('.'); if (h[g].idx == c || f[0] && f[0] == c.replace('.', '')) { var k = document.createEvent('HTMLEvents'); k.initEvent(f[0], !1, !0); this.sound.dispatchEvent(k); } } return this; }; this.fadeTo = function(b, a, g) { function c() { setTimeout(function() { f < b && j.volume <
b ? (j.setVolume(j.volume += 1), c()) : f > b && j.volume > b ? (j.setVolume(j.volume -= 1), c()) : g instanceof Function && g.apply(j); }, h); } if (!e) return this; a instanceof Function ? (g = a, a = buzz.defaults.duration) : a = a || buzz.defaults.duration; var f = this.volume,
h = a / Math.abs(f - b),
j = this; this.play(); this.whenReady(function() { c(); }); return this; }; this.fadeIn = function(b, a) { return !e ? this : this.setVolume(0).fadeTo(100, b, a); }; this.fadeOut = function(b, a) { return !e ? this : this.fadeTo(0, b, a); }; this.fadeWith = function(b, a) { if (!e) return this; this.fadeOut(a,
function() { this.stop(); }); b.play().fadeIn(a); return this; }; this.whenReady = function(b) { if (!e) return null; var a = this; this.sound.readyState === 0 ? this.bind('canplay.buzzwhenready', function() { b.call(a); }) : b.call(a); }; if (e && c) { for (var l in buzz.defaults)buzz.defaults.hasOwnProperty(l) && (a[l] = a[l] || buzz.defaults[l]); this.sound = document.createElement('audio'); if (c instanceof Array) for (var m in c)c.hasOwnProperty(m) && b(this.sound, c[m]); else if (a.formats.length) { for (var n in a.formats) { a.formats.hasOwnProperty(n) &&
b(this.sound, c + '.' + a.formats[n]); } } else b(this.sound, c); a.loop && this.loop(); a.autoplay && (this.sound.autoplay = 'autoplay'); this.sound.preload = !0 === a.preload ? 'auto' : !1 === a.preload ? 'none' : a.preload; this.setVolume(a.volume); buzz.sounds.push(this); } },
group: function(c) { function a() { for (var b = f(null, arguments), a = b.shift(), h = 0; h < c.length; h++)c[h][a].apply(c[h], b); } function f(a, c) { return a instanceof Array ? a : Array.prototype.slice.call(c); }c = f(c, arguments); this.getSounds = function() { return c; }; this.add = function(a) { a =
f(a, arguments); for (var g = 0; g < a.length; g++)c.push(a[g]); }; this.remove = function(a) { a = f(a, arguments); for (var g = 0; g < a.length; g++) for (var h = 0; h < c.length; h++) if (c[h] == a[g]) { c.splice(h, 1); break; } }; this.load = function() { a('load'); return this; }; this.play = function() { a('play'); return this; }; this.togglePlay = function() { a('togglePlay'); return this; }; this.pause = function(b) { a('pause', b); return this; }; this.stop = function() { a('stop'); return this; }; this.mute = function() { a('mute'); return this; }; this.unmute = function() { a('unmute');
return this; }; this.toggleMute = function() { a('toggleMute'); return this; }; this.setVolume = function(b) { a('setVolume', b); return this; }; this.increaseVolume = function(b) { a('increaseVolume', b); return this; }; this.decreaseVolume = function(b) { a('decreaseVolume', b); return this; }; this.loop = function() { a('loop'); return this; }; this.unloop = function() { a('unloop'); return this; }; this.setTime = function(b) { a('setTime', b); return this; }; this.set = function(b, c) { a('set', b, c); return this; }; this.bind = function(b, c) { a('bind', b, c); return this; };
this.unbind = function(b) { a('unbind', b); return this; }; this.bindOnce = function(b, c) { a('bindOnce', b, c); return this; }; this.trigger = function(b) { a('trigger', b); return this; }; this.fade = function(b, c, f, k) { a('fade', b, c, f, k); return this; }; this.fadeIn = function(b, c) { a('fadeIn', b, c); return this; }; this.fadeOut = function(b, c) { a('fadeOut', b, c); return this; }; },
all: function() { return new buzz.group(buzz.sounds); },
isSupported: function() { return !!buzz.el.canPlayType; },
isOGGSupported: function() { return !!buzz.el.canPlayType && buzz.el.canPlayType('audio/ogg; codecs="vorbis"'); },
isWAVSupported: function() { return !!buzz.el.canPlayType && buzz.el.canPlayType('audio/wav; codecs="1"'); },
isMP3Supported: function() { return !!buzz.el.canPlayType && buzz.el.canPlayType('audio/mpeg;'); },
isAACSupported: function() { return !!buzz.el.canPlayType && (buzz.el.canPlayType('audio/x-m4a;') || buzz.el.canPlayType('audio/aac;')); },
toTimer: function(c, a) { var f, 
b, 
g; f = Math.floor(c / 3600); f = isNaN(f) ? '--' : f >= 10 ? f : '0' + f; b = a ? Math.floor(c / 60 % 60) : Math.floor(c / 60); b = isNaN(b) ? '--' : b >= 10 ? b : '0' + b; g = Math.floor(c % 60); g = isNaN(g) ?
'--' : g >= 10 ? g : '0' + g; return a ? f + ':' + b + ':' + g : b + ':' + g; },
fromTimer: function(c) { var a = c.toString().split(':'); a && a.length == 3 && (c = 3600 * parseInt(a[0], 10) + 60 * parseInt(a[1], 10) + parseInt(a[2], 10)); a && a.length == 2 && (c = 60 * parseInt(a[0], 10) + parseInt(a[1], 10)); return c; },
toPercent: function(c, a, f) { f = Math.pow(10, f || 0); return Math.round(100 * c / a * f) / f; },
fromPercent: function(c, a, f) { f = Math.pow(10, f || 0); return Math.round(a / 100 * c * f) / f; } };